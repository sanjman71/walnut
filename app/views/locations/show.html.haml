- title(@title)
- robots('index', 'follow')
- content_for :head do
  %script{:src => GOOGLE_MAPS_API_URL, :type => 'text/javascript'}
- javascript("jquery.jmap", "maps", "places")

.span-15.prepend-1.mat.padding-top-10.padding-bottom-10
  %h1{:style => 'font-size: 2.0em;'}= @h1
  - if has_privilege?('manage site')
    %h4.small{:style => 'color: #777777;'}
      = @location.location_sources.collect{ |s| "#{s.source_type}:#{s.source_id}"}.join(" | ")
      == &nbsp;|&nbsp;
      == Popularity:#{@location.popularity}
      == &nbsp;|&nbsp;
      == Events:#{@location.events_count}
      == &nbsp;
      = link_to image_tag('search.png'), edit_location_path(@location), :title => 'Edit'

  %h4#breadcrumbs
    = render(:partial => 'shared/breadcrumbs', :locals => {:tree => 'search', :country => @country, :state => @state, :city => @city, :link_all => true})

.span-8.padding-top-5.bottom.last#weather
  - unless @weather.blank?
    - cache("#{@weather.name.to_url_param}", :expires_in => CacheExpire.weather) do
      = render(:partial => 'shared/weather', :locals => {:weather => @weather})

%hr.space

.span-15.prepend-1
  = display_flash

.span-18.prepend-1
  .span-18#address_phone
    .span-11
      -# show location map only if its mappable
      = render(:partial => 'google_map', :locals => {:location => @location}) if @location.mappable?
    
    .span-6.append-1.last
      -# location address
      %h2#address
        = [@location.street_address, city_state_zip(@city, @state, @zip)].reject(&:blank?).join("<br/>")     
        
      -# location phone 
      %h3#phone
        - unless @location.phone_numbers_count == 0
          = render(:partial => 'phone', :locals => {:location => @location, :max_phones => 3})
        
      -# location events
      %h4#add_event
        - if has_privilege?('manage site') and @location.events_count == 0
          = link_to "Add Event", new_event_path(@location.id), :style => 'font-size: 1.0em;', :class => 'event add'
          
      -# location recommendations
      / %h4.recommendations#recommend
      /   = render(:partial => "recommendations", :locals => {:location => @location})
        
  %hr.space

  -# company and locality tags
  .span-18#all_tags
    .span-7.colborder#tags
      %h2.location.tags.keywords.divider== Keyword Tags
      - tags = @company.tags
      - if tags.blank?
        -# add space to fill in column border
        == &nbsp;
      - else
        - tags.each do |tag|
          %span{:style => 'padding-right: 3px;'}
            - klasses = ["tag big"].push(cycle('even', 'odd'))
            = link_to(tag.name, build_search_route('search', 'city', :country => @country, :state => @state, :city => @city, :tag => tag.name.to_url_param), :class => klasses.join(' '))
      
    .span-9.last#locality_tags
      %h2.location.tags.geography.divider== Geography Tags
      - ([@state, @city, @zip].compact + @neighborhoods).each do |locality|
        %span{:style => 'padding-right: 3px;'}
          - klasses = ["locality big"].push(cycle('even', 'odd'))
          = link_to locality.name, infer_locality_route(locality.name, :country => @country, :state => @state, :city => @city, :zip => @zip, :neighborhoods => @neighborhoods), :class => klasses.join(' ')

  %hr.space

  - if @location_events.empty?
    -# nearby locations
    .last#nearby_places{:class => @nearby_event_venues.blank? ? "span-18" : "span-7 colborder"}
      = render(:partial => 'nearby_places', :locals => {:locations => @nearby_locations, :title => 'Nearby Places'}) unless @nearby_locations.blank?
    
    -# nearby event venues
    .span-9.last#nearby_event_venues
      = render(:partial => 'nearby_places', :locals => {:locations => @nearby_event_venues, :title => 'Nearby Event Venues'}) unless @nearby_event_venues.blank?
  - else
    -# location events
    .last#location_events{:class => "span-7 colborder"}
      = render(:partial => 'location_events', :locals => {:location => @location, :events => @location_events, :title => 'Upcoming Events'})

    -# nearby event venues
    .span-9.last#nearby_event_venues
      = render(:partial => 'nearby_places', :locals => {:locations => @nearby_event_venues, :title => 'Nearby Event Venues'}) unless @nearby_event_venues.blank?
  
.span-5.last#sidebar{:style => 'text-align: right;'}
  -# google ad - location show right wide skyscraper
  = render :partial => 'adsense/location_show_right_wideskyscraper'
